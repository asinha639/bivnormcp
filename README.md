Bayesian Change Point Detection for Bivariate Normal Data
================

- [Multiple Change Points Detection under the Bivariate Normal
  Model](#multiple-change-points-detection-under-the-bivariate-normal-model)
  - [Introduction](#introduction)
  - [Simulated Example](#simulated-example)
  - [Run Change Point Detection](#run-change-point-detection)
  - [Correct the Indices and Visualize Change
    Points](#correct-the-indices-and-visualize-change-points)

# Multiple Change Points Detection under the Bivariate Normal Model

## Introduction

This demonstrates how to use the *bivnormcp* package to detect change
points in bivariate normal data and visualize them.

## Simulated Example

Weâ€™ll create a synthetic dataset with two change points:

``` r
set.seed(123)

test_data <- data.frame(
  var1 = c(rnorm(50, 0, 0.5), rnorm(25, 5, 0.5), rnorm(25, 15, 0.5)),
  var2 = c(rnorm(50, 0, 0.5), rnorm(25, 5, 0.5), rnorm(25, 15, 0.5))
)
```

## Run Change Point Detection

``` r
result <- bivar_norm_cp(test_data$var1, test_data$var2,
                        th_cp = 0.9, 
                        save_output = FALSE)  # Set to TRUE for .xlsx file to be saved
result
#> $x1
#>   [1] -0.28023782 -0.11508874  0.77935416  0.03525420  0.06464387  0.85753249
#>   [7]  0.23045810 -0.63253062 -0.34342643 -0.22283099  0.61204090  0.17990691
#>  [13]  0.20038573  0.05534136 -0.27792057  0.89345657  0.24892524 -0.98330858
#>  [19]  0.35067795 -0.23639570 -0.53391185 -0.10898746 -0.51300222 -0.36444561
#>  [25] -0.31251963 -0.84334666  0.41889352  0.07668656 -0.56906847  0.62690746
#>  [31]  0.21323211 -0.14753574  0.44756283  0.43906674  0.41079054  0.34432013
#>  [37]  0.27695883 -0.03095586 -0.15298133 -0.19023550 -0.34735349 -0.10395864
#>  [43] -0.63269818  1.08447798  0.60398100 -0.56155429 -0.20144242 -0.23332768
#>  [49]  0.38998256 -0.04168453  5.12665926  4.98572662  4.97856477  5.68430114
#>  [55]  4.88711451  5.75823530  4.22562360  5.29230687  5.06192712  5.10797078
#>  [61]  5.18981974  4.74883827  4.83339631  4.49071231  4.46410439  5.15176432
#>  [67]  5.22410489  5.02650211  5.46113373  6.02504234  4.75448442  3.84541556
#>  [73]  5.50286926  4.64539962  4.65599569 15.51278568 14.85761350 14.38964114
#>  [79] 15.09065174 14.93055432 15.00288209 15.19264020 14.81466998 15.32218827
#>  [85] 14.88975672 15.16589098 15.54841951 15.21759075 14.83703421 15.57440381
#>  [91] 15.49675193 15.27419848 15.11936587 14.68604696 15.68032622 14.69987021
#>  [97] 16.09366650 15.76630531 14.88214982 14.48678955
#> 
#> $x2
#>   [1] -0.35520328  0.12844185 -0.12334594 -0.17377130 -0.47580928 -0.02251386
#>   [7] -0.39245223 -0.83397097 -0.19011326  0.45949830 -0.28767348  0.30398216
#>  [13] -0.80894135 -0.02778098  0.25970360  0.15057668  0.05283810 -0.32035300
#>  [19] -0.42485217 -0.51206440  0.05882330 -0.47373731 -0.24527872 -0.12804610
#>  [25]  0.92193100 -0.32597495  0.11769329  0.03898042 -0.48092832 -0.03565404
#>  [31]  0.72227543  0.22575203  0.02061646 -0.21124842 -1.02662361  0.56566861
#>  [37] -0.73032004  0.36997376  0.95455178 -0.72194658  0.35089217 -0.13109874
#>  [43] -0.78607208 -0.75733383 -0.80076809 -0.26545326 -0.73087779  0.34395839
#>  [49]  1.05005447 -0.64351524  5.39386942  5.38452112  5.16610129  4.49581170
#>  [55]  4.94027370  4.85980233  5.28149477  4.81378062  5.48848669  4.81270957
#>  [61]  5.52635573  4.47541150  4.36992238  6.62051997  4.79157121  5.14911380
#>  [67]  5.31828484  4.75810969  5.25843102  5.18448226  4.89230975  5.03264652
#>  [73]  4.98296637  6.06422595  4.62933195 14.45200187 15.01889420 15.15524037
#>  [79] 15.21826174 14.77081733 14.46833693 15.63159259 14.82517481 14.56724357
#>  [85] 14.88186022 14.90141205 15.55496014 15.04236865 15.37702689 14.75035399
#>  [91] 15.10722265 14.83765704 15.04729176 14.55231832 14.34459923 15.99860669
#>  [97] 15.30035441 14.37436432 14.69441704 14.40725996
#> 
#> $prob_max
#>             [,1] [,2]
#>   [1,] 0.9979290    0
#>   [2,] 0.9945776    0
#>   [3,] 0.9956605    0
#>   [4,] 0.9955205    0
#>   [5,] 0.9935281    0
#>   [6,] 0.9941091    0
#>   [7,] 0.9942935    0
#>   [8,] 0.9944815    0
#>   [9,] 0.9897565    0
#>  [10,] 0.9917490    0
#>  [11,] 0.9920558    0
#>  [12,] 0.9921507    0
#>  [13,] 0.9932116    0
#>  [14,] 0.9900119    0
#>  [15,] 0.9919504    0
#>  [16,] 0.9930271    0
#>  [17,] 0.9910173    0
#>  [18,] 0.9932876    0
#>  [19,] 0.9941956    0
#>  [20,] 0.9913394    0
#>  [21,] 0.9928226    0
#>  [22,] 0.9918897    0
#>  [23,] 0.9910539    0
#>  [24,] 0.9743651    0
#>  [25,] 0.9777765    0
#>  [26,] 0.9878315    0
#>  [27,] 0.9896699    0
#>  [28,] 0.9904922    0
#>  [29,] 0.9921667    0
#>  [30,] 0.9908980    0
#>  [31,] 0.9905281    0
#>  [32,] 0.9917860    0
#>  [33,] 0.9918057    0
#>  [34,] 0.9789903    0
#>  [35,] 0.9895712    0
#>  [36,] 0.9871207    0
#>  [37,] 0.9886225    0
#>  [38,] 0.9737070    0
#>  [39,] 0.9877613    0
#>  [40,] 0.9842745    0
#>  [41,] 0.9865671    0
#>  [42,] 0.9912637    0
#>  [43,] 0.9654154    0
#>  [44,] 0.9547677    0
#>  [45,] 0.9711169    0
#>  [46,] 0.9723217    0
#>  [47,] 0.9755005    0
#>  [48,] 0.9779766    0
#>  [49,] 0.9846031    0
#>  [50,] 0.9997747   50
#>  [51,] 0.9988292   50
#>  [52,] 0.9983230   50
#>  [53,] 0.9954243   50
#>  [54,] 0.9964824   50
#>  [55,] 0.9961886   50
#>  [56,] 0.9956868   50
#>  [57,] 0.9968274   50
#>  [58,] 0.9969912   50
#>  [59,] 0.9970812   50
#>  [60,] 0.9967899   50
#>  [61,] 0.9936516   50
#>  [62,] 0.9903377   50
#>  [63,] 0.9905237   50
#>  [64,] 0.9928362   50
#>  [65,] 0.9947368   50
#>  [66,] 0.9949995   50
#>  [67,] 0.9953091   50
#>  [68,] 0.9946898   50
#>  [69,] 0.9908735   50
#>  [70,] 0.9925112   50
#>  [71,] 0.9884865   50
#>  [72,] 0.9932846   50
#>  [73,] 0.9944684   50
#>  [74,] 0.9936203   50
#>  [75,] 1.0000000   75
#>  [76,] 0.9993403   75
#>  [77,] 0.9982788   75
#>  [78,] 0.9983500   75
#>  [79,] 0.9985190   75
#>  [80,] 0.9987338   75
#>  [81,] 0.9985198   75
#>  [82,] 0.9984294   75
#>  [83,] 0.9986279   75
#>  [84,] 0.9986416   75
#>  [85,] 0.9986126   75
#>  [86,] 0.9984997   75
#>  [87,] 0.9984373   75
#>  [88,] 0.9982241   75
#>  [89,] 0.9984166   75
#>  [90,] 0.9984875   75
#>  [91,] 0.9984806   75
#>  [92,] 0.9984883   75
#>  [93,] 0.9984279   75
#>  [94,] 0.9973203   75
#>  [95,] 0.9954723   75
#>  [96,] 0.9976614   75
#>  [97,] 0.9960227   75
#>  [98,] 0.9975193   75
#>  [99,] 0.9980058   75
#> 
#> $series_length
#> [1] 100
```

## Correct the Indices and Visualize Change Points

``` r
change_pts <- index_correction(result$prob_max[, 2])
plot_cp_3d(result$x1, result$x2, change_pts)
#> Warning: 'layout' objects don't have these attributes: 'NA'
#> Valid attributes include:
#> '_deprecated', 'activeshape', 'annotations', 'autosize', 'autotypenumbers', 'calendar', 'clickmode', 'coloraxis', 'colorscale', 'colorway', 'computed', 'datarevision', 'dragmode', 'editrevision', 'editType', 'font', 'geo', 'grid', 'height', 'hidesources', 'hoverdistance', 'hoverlabel', 'hovermode', 'images', 'legend', 'mapbox', 'margin', 'meta', 'metasrc', 'modebar', 'newshape', 'paper_bgcolor', 'plot_bgcolor', 'polar', 'scene', 'selectdirection', 'selectionrevision', 'separators', 'shapes', 'showlegend', 'sliders', 'smith', 'spikedistance', 'template', 'ternary', 'title', 'transition', 'uirevision', 'uniformtext', 'updatemenus', 'width', 'xaxis', 'yaxis', 'barmode', 'bargap', 'mapType'
```

<div class="plotly html-widget html-fill-item" id="htmlwidget-6e16c2883c26dd1edd48" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-6e16c2883c26dd1edd48">{"x":{"data":[{"x":[-0.2802378232761063,-0.11508874474163998,0.77935415707456202,0.035254195712288001,0.064643867580473122,0.85753249344164051,0.23045810299460115,-0.63253061730326698,-0.34342642594676304,-0.22283098504997903,0.61204089871973077,0.17990691352868191,0.20038572529702608,0.055341357972559853,-0.27792056737703746,0.89345656840153909,0.2489252391146197,-0.9833085783148191,0.35067795078184277,-0.23639570386396702,-0.53391185299342259,-0.10898745732914757,-0.51300222415361985,-0.36444561464557013,-0.31251963392462834,-0.84334665537120668,0.41889352224726234,0.076686558918257611,-0.56906846850597381,0.62690746053496338,0.21323211073840678,-0.14753574149613558,0.44756283052251111,0.43906674376652111,0.41079054081874355,0.3443201270500455,0.27695882676879441,-0.03095585528836084,-0.15298133186995838,-0.19023550050619134,-0.34735348946025635,-0.10395863900979939,-0.63269817578413223,1.0844779826692563,0.60398099915249526,-0.56155429160167458,-0.20144241764953799,-0.23332767681160943,0.38998255916815894,-0.041684533235914638,5.1266592569973772,4.9857266223256484,4.9785647713543417,5.6843011420072287,4.8871145071703666,5.7582353022147696,4.2256235978848897,5.2923068748180349,5.0619271219223068,5.1079707843719859,5.1898197413799414,4.7488382734453491,4.8333963081652902,4.4907123084464553,4.4641043867622114,5.1517643207021289,5.2241048893147131,5.0265021133652521,5.4611337339398691,6.0250423428135722,4.7544844169717324,3.8454155621795936,5.5028692622311279,4.6453996187088036,4.6559956917663214,15.51278568484835,14.857613496474496,14.389641143872732,15.090651739874575,14.930554318780478,15.002882092949944,15.192640200563165,14.814669984103796,15.322188274259416,14.889756719090625,15.165890981957848,15.548419506574675,15.217590745416901,14.837034207234387,15.574403809225547,15.496751927981059,15.274198479754036,15.11936586755572,14.686046961980315,15.680326224265004,14.699870206426436,16.093666496508288,15.766305313092595,14.882149820449762,14.486789549846609],"y":[-0.3552032818496505,0.12844185457826476,-0.12334593923118681,-0.17377129969886659,-0.47580928363250785,-0.022513862404460135,-0.39245223472853791,-0.83397096829406836,-0.19011326014388122,0.45949830453038298,-0.28767348130419595,0.30398216111251669,-0.80894135414458201,-0.027780982762269719,0.25970360197173115,0.1505766810833572,0.052838097074471665,-0.32035300415268819,-0.42485217301679112,-0.51206439530245662,0.058823298550062936,-0.47373730709240108,-0.24527872185033417,-0.12804609609912362,0.92193100261610372,-0.32597495084772926,0.11769328614242847,0.038980424781855386,-0.48092831706506428,-0.035654043061799333,0.72227542921167442,0.22575202653960733,0.020616460996469965,-0.21124841616981241,-1.0266236107702578,0.56566860670708774,-0.73032003546241098,0.36997375543866723,0.95455178460874168,-0.72194658048589966,0.35089216768735543,-0.131098744701234,-0.78607207957274383,-0.75733382689087569,-0.80076808678729672,-0.26545326108515149,-0.73087779249794993,0.34395838648791377,1.0500544702628358,-0.64351523801758947,5.3938694237375895,5.3845211205004553,5.1661012894750584,4.4958116958614962,4.9402736966846703,4.8598023324148762,5.2814947666102396,4.8137806219480854,5.4884866933428107,4.8127095711164927,5.526355732789666,4.4754114966669674,4.3699223776209442,6.6205199674712025,4.7915712059197837,5.1491137957703579,5.3182848370169244,4.7581096871456285,5.2584310221568042,5.1844822636925434,4.8923097461791532,5.0326465167626573,4.9829663731307683,6.0642259495080904,4.6293319518635858,14.452001866462668,15.018894199585539,15.155240374721568,15.218261739455091,14.770817333644446,14.468336933014404,15.631592588044745,14.825174806023222,14.567243568673312,14.881860215529452,14.901412052825723,15.554960144856821,15.042368646098598,15.37702689259226,14.750353991413869,15.107222654790801,14.837657044254582,15.047291764086786,14.55231832101123,14.344599233336014,15.998606692373983,15.300354411836208,14.374364319187528,14.69441704165979,14.407259957701346],"z":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],"mode":"markers","marker":{"color":"#00BFFF","size":4,"line":{"color":"blue","width":1}},"name":"Data","type":"scatter3d","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[-0.041684533235914638,4.6559956917663214],"y":[-0.64351523801758947,4.6293319518635858],"z":[50,75],"mode":"markers","marker":{"color":"red","size":5,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"name":"Change Points","type":"scatter3d","error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null},{"x":[-0.041684533235914638,4.6559956917663214],"y":[-0.64351523801758947,4.6293319518635858],"z":[50,75],"mode":"lines","line":{"color":"red","width":2},"showlegend":false,"type":"scatter3d","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"frame":null}],"layout":{"NA":{"anchor":[],"domain":[0,1]},"NA2":{"anchor":[],"domain":[0,1]},"NA3":{"anchor":[],"domain":[0,1]},"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Variable 1"},"yaxis":{"title":"Variable 2"},"zaxis":{"title":"Time"}},"hovermode":"closest","showlegend":false,"plot_bgcolor":"grey"},"attrs":{"63701e731e3":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":4,"color":"#00BFFF","line":{"color":"blue","width":1}},"name":"Data","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"637047897969":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":5,"color":"red"},"showlegend":false,"name":"Change Points","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"637023444f6d":{"x":{},"y":{},"z":{},"mode":"lines","line":{"color":"red","width":2},"showlegend":false,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
